#!/bin/sh

set -e

msg_file="$1"
if [ -z "$msg_file" ] || [ ! -f "$msg_file" ]; then
  exit 0
fi

# Allow override via commit message
if grep -q "\[no-docs\]" "$msg_file"; then
  exit 0
fi

changed_code=$(git diff --cached --name-only | grep -E '\.(py|js)$' || true)
changed_docs=$(git diff --cached --name-only | grep -E 'docs/_ai_context/(CURRENT_STATE|DEVLOG)\.md' || true)

if [ -n "$changed_code" ] && [ -z "$changed_docs" ]; then
  echo "Code changed but tracking docs not updated." >&2
  echo "If intentional, add [no-docs] to commit message." >&2
  exit 1
fi

exit 0
